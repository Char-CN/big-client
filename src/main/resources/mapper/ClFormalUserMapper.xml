<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.blazer.bigclient.mapper.ClFormalUserMapper" >
  <resultMap id="BaseResultMap" type="org.blazer.bigclient.model.ClFormalUser" >
    <!--
      WARNING - @mbggenerated
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="phone_number" property="phoneNumber" jdbcType="BIGINT" />
    <result column="report_or_allot" property="reportOrAllot" jdbcType="VARCHAR" />
    <result column="report_or_allot_date" property="reportOrAllotDate" jdbcType="VARCHAR" />
    <result column="user_identify" property="userIdentify" jdbcType="VARCHAR" />
    <result column="if_delete" property="ifDelete" jdbcType="INTEGER" />
    <result column="mtime" property="mtime" jdbcType="TIMESTAMP" />
    <result column="ctime" property="ctime" jdbcType="TIMESTAMP" />
  </resultMap>


  <select id="selectMaxVersionList" resultType="List">
    SELECT a.*,b.*,c.actual_name
    FROM
    (SELECT a.user_id,a.version_no,a.advisor_id FROM cl_formal_user_version a
    JOIN (SELECT user_id,max(version_no) AS max_version_no FROM cl_formal_user_version GROUP BY user_id) b
    ON a.user_id = b.user_id
    AND a.version_no = b.max_version_no) a
    LEFT OUTER JOIN cl_formal_user b ON a.user_id = b.id
    LEFT OUTER JOIN kam_advisor c ON a.advisor_id = c.id
  </select>


</mapper>